<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>চেকআউট - TinyStepsBD</title>
    <meta name="description" content="আপনার অর্ডার সম্পন্ন করুন। নিরাপদ চেকআউট এবং ক্যাশ অন ডেলিভারি সহ TinyStepsBD এ শিশু জুতা অর্ডার করুন।">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/animations.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/icons/ui/logo.png">
</head>
<body>
    <!-- Header Component -->
    <div id="header-container"></div>

    <!-- Breadcrumb -->
    <section class="breadcrumb">
        <div class="container">
            <nav class="breadcrumb-nav">
                <a href="index.html">হোম</a>
                <span class="separator">/</span>
                <a href="cart.html">কার্ট</a>
                <span class="separator">/</span>
                <span class="current">চেকআউট</span>
            </nav>
        </div>
    </section>

    <!-- Checkout Section -->
    <section class="checkout-section">
        <div class="container">
            <div class="checkout-layout">
                <!-- Checkout Form -->
                <div class="checkout-form">
                    <div class="checkout-header">
                        <h2>অর্ডার তথ্য</h2>
                        <p>আপনার তথ্য দিন এবং অর্ডার সম্পন্ন করুন</p>
                    </div>

                    <form id="checkout-form">
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h3>গ্রাহক তথ্য</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="customer-name">পুরো নাম *</label>
                                    <input type="text" id="customer-name" name="customer_name" required placeholder="আপনার পুরো নাম লিখুন">
                                    <span class="error-message" id="name-error"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="customer-phone">মোবাইল নম্বর *</label>
                                    <input type="tel" id="customer-phone" name="phone" required placeholder="01XXXXXXXXX">
                                    <span class="error-message" id="phone-error"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="customer-email">ইমেইল ঠিকানা</label>
                                    <input type="email" id="customer-email" name="email" placeholder="আপনার ইমেইল ঠিকানা">
                                    <span class="error-message" id="email-error"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Delivery Information -->
                        <div class="form-section">
                            <h3>ডেলিভারি তথ্য</h3>
                            
                            <div class="form-group">
                                <label for="delivery-area">ডেলিভারি এলাকা *</label>
                                <select id="delivery-area" name="delivery_area" required>
                                    <option value="">এলাকা নির্বাচন করুন</option>
                                    <option value="inside_dhaka">ঢাকা শহরের ভিতরে</option>
                                    <option value="outside_dhaka">ঢাকার বাইরে (বিভাগীয় শহর)</option>
                                    <option value="outside_divisional">বিভাগীয় শহরের বাইরে</option>
                                </select>
                                <span class="error-message" id="area-error"></span>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="delivery-address">সম্পূর্ণ ঠিকানা *</label>
                                <textarea id="delivery-address" name="address" required rows="3" placeholder="বাড়ি নং, রোড নং, এলাকা, থানা, জেলা"></textarea>
                                <span class="error-message" id="address-error"></span>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="district">জেলা *</label>
                                    <input type="text" id="district" name="district" required placeholder="জেলার নাম">
                                    <span class="error-message" id="district-error"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="thana">থানা *</label>
                                    <input type="text" id="thana" name="thana" required placeholder="থানার নাম">
                                    <span class="error-message" id="thana-error"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-section">
                            <h3>পেমেন্ট মাধ্যম</h3>
                            <div class="payment-methods">
                                <div class="payment-method active" data-method="cod">
                                    <div class="method-header">
                                        <input type="radio" id="payment-cod" name="payment_method" value="cod" checked>
                                        <label for="payment-cod">
                                            <span class="method-name">ক্যাশ অন ডেলিভারি</span>
                                            <span class="method-description">পণ্য হাতে পেয়ে তারপর পেমেন্ট করুন</span>
                                        </label>
                                    </div>
                                    <div class="method-content">
                                        <p>পণ্য ডেলিভারির সময় আমাদের ডেলিভারি এজেন্টকে নগদ অর্থ প্রদান করুন।</p>
                                        <div class="method-features">
                                            <span class="feature">১০০% নিরাপদ</span>
                                            <span class="feature">কোনো অতিরিক্ত চার্জ নেই</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="payment-method" data-method="bkash">
                                    <div class="method-header">
                                        <input type="radio" id="payment-bkash" name="payment_method" value="bkash">
                                        <label for="payment-bkash">
                                            <span class="method-name">bKash</span>
                                            <span class="method-description">দ্রুত এবং নিরাপদ পেমেন্ট</span>
                                        </label>
                                    </div>
                                    <div class="method-content">
                                        <p>bKash এ পেমেন্ট করার নির্দেশনা:</p>
                                        <ol>
                                            <li>bKash অ্যাপে যান</li>
                                            <li>পেমেন্ট অপশনে ক্লিক করুন</li>
                                            <li>মার্চেন্ট নম্বর: 01XXXXXXXXX</li>
                                            <li>Amount: <span id="bkash-amount">০</span> ৳</li>
                                            <li>রেফারেন্স: আপনার অর্ডার আইডি</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="form-section">
                            <h3>অতিরিক্ত তথ্য</h3>
                            <div class="form-group full-width">
                                <label for="special-notes">বিশেষ নির্দেশনা (ঐচ্ছিক)</label>
                                <textarea id="special-notes" name="special_notes" rows="3" placeholder="ডেলিভারি সম্পর্কিত কোন বিশেষ নির্দেশনা থাকলে এখানে লিখুন..."></textarea>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="form-section">
                            <div class="terms-agreement">
                                <input type="checkbox" id="terms-agree" name="terms_agree" required>
                                <label for="terms-agree">
                                    আমি <a href="terms.html" target="_blank">সেবার শর্তাবলী</a> এবং 
                                    <a href="privacy.html" target="_blank">গোপনীয়তা নীতি</a> পড়েছি এবং স্বীকার করছি *
                                </label>
                                <span class="error-message" id="terms-error"></span>
                            </div>
                        </div>

                        <!-- Checkout Actions -->
                        <div class="checkout-actions">
                            <a href="cart.html" class="btn btn-outline">
                                <span class="btn-icon">←</span>
                                কার্টে ফিরে যান
                            </a>
                            <button type="submit" class="btn btn-primary btn-large" id="place-order-btn">
                                <span class="btn-icon">✅</span>
                                অর্ডার কনফার্ম করুন
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Order Summary -->
                <div class="order-summary-sidebar">
                    <div class="summary-card">
                        <h3>আপনার অর্ডার</h3>
                        
                        <!-- Order Items -->
                        <div class="order-items" id="checkout-items">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>অর্ডার আইটেম লোড হচ্ছে...</p>
                            </div>
                        </div>

                        <!-- Order Calculation -->
                        <div class="order-calculation">
                            <div class="calculation-row">
                                <span>সাবটোটাল</span>
                                <span id="checkout-subtotal">০ ৳</span>
                            </div>
                            <div class="calculation-row">
                                <span>ডেলিভারি চার্জ</span>
                                <span id="checkout-delivery">০ ৳</span>
                            </div>
                            <div class="calculation-row discount">
                                <span>ডিসকাউন্ট</span>
                                <span id="checkout-discount">০ ৳</span>
                            </div>
                            <div class="calculation-row total">
                                <span>মোট Amount</span>
                                <span id="checkout-total">০ ৳</span>
                            </div>
                        </div>

                        <!-- Delivery Information -->
                        <div class="delivery-estimate">
                            <h4>আনুমানিক ডেলিভারি সময়</h4>
                            <div class="estimate-info" id="delivery-estimate">
                                এলাকা নির্বাচন করুন
                            </div>
                        </div>

                        <!-- Security Badges -->
                        <div class="security-badges">
                            <div class="badge">
                                <img src="assets/images/icons/features/secure.png" alt="নিরাপদ" onerror="this.src='assets/images/placeholder.jpg'">
                                <span>নিরাপদ চেকআউট</span>
                            </div>
                            <div class="badge">
                                <img src="assets/images/icons/features/privacy.png" alt="গোপনীয়তা" onerror="this.src='assets/images/placeholder.jpg'">
                                <span>গোপনীয়তা সুরক্ষিত</span>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Support -->
                    <div class="support-card">
                        <h4>সহায়তা প্রয়োজন?</h4>
                        <div class="support-info">
                            <div class="support-item">
                                <img src="assets/images/icons/ui/phone.png" alt="ফোন" onerror="this.src='assets/images/placeholder.jpg'">
                                <div>
                                    <strong>কল করুন</strong>
                                    <span>+8801XXX-XXXXXX</span>
                                </div>
                            </div>
                            <div class="support-item">
                                <img src="assets/images/icons/ui/whatsapp.png" alt="হোয়াটসঅ্যাপ" onerror="this.src='assets/images/placeholder.jpg'">
                                <div>
                                    <strong>হোয়াটসঅ্যাপ</strong>
                                    <span>+8801XXX-XXXXXX</span>
                                </div>
                            </div>
                            <div class="support-item">
                                <img src="assets/images/icons/ui/email.png" alt="ইমেইল" onerror="this.src='assets/images/placeholder.jpg'">
                                <div>
                                    <strong>ইমেইল</strong>
                                    <span>support@tinystepsbd.com</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Component -->
    <div id="footer-container"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner large"></div>
            <h3>অর্ডার প্রসেস হচ্ছে</h3>
            <p>অনুগ্রহ করে অপেক্ষা করুন...</p>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/cart.js"></script>
    <script src="assets/js/checkout.js"></script>
    <script src="assets/js/data-manager.js"></script>
    
    <script>
        // Load header and footer components
        document.addEventListener('DOMContentLoaded', function() {
            // Load header
            fetch('components/header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;
                    initializeMobileMenu();
                    setActiveNavLink('checkout');
                    updateCartCount();
                });

            // Load footer
            fetch('components/footer.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('footer-container').innerHTML = data;
                });

            // Initialize checkout page
            initializeCheckoutPage();
        });

        function initializeMobileMenu() {
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const mobileNav = document.querySelector('.mobile-nav');
            
            if (mobileMenuBtn && mobileNav) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileNav.classList.toggle('active');
                });
            }
        }

        function setActiveNavLink(page) {
            // This function will be implemented in main JS
            console.log('Setting active nav for:', page);
        }

        function updateCartCount() {
            // This function will be implemented in cart.js
            console.log('Updating cart count...');
        }

        function initializeCheckoutPage() {
            // Load checkout items
            loadCheckoutItems();
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Initialize form validation
            initializeFormValidation();
        }

        function loadCheckoutItems() {
            const cartItems = getCartItems();
            
            if (cartItems.length === 0) {
                // Redirect to cart if empty
                window.location.href = 'cart.html';
                return;
            }
            
            displayCheckoutItems(cartItems);
            updateCheckoutSummary(cartItems);
        }

        function getCartItems() {
            // This will be implemented in cart.js
            // For now, return sample data
            return [
                {
                    id: 'TS-BD_517',
                    name: '০-১.৫ বছর বয়সী শিশুর বাচ্চাদের জুতা',
                    price: 890,
                    quantity: 1,
                    color: 'সাদা',
                    size: '25',
                    image: 'https://drive.google.com/uc?export=view&id=1QSWmGWKcmh0PHEZDThC2m4PMOyy4iljU'
                },
                {
                    id: 'TS-BD_518',
                    name: 'LED হালকা ছেলেদের স্পোর্টস জুতা',
                    price: 1490,
                    quantity: 2,
                    color: 'খাকি',
                    size: '26',
                    image: 'https://drive.google.com/uc?export=view&id=13TN1Fx8DJIWv8QUoyuAbCbtWg9AERmnu'
                }
            ];
        }

        function displayCheckoutItems(items) {
            const checkoutItemsContainer = document.getElementById('checkout-items');
            
            checkoutItemsContainer.innerHTML = items.map(item => `
                <div class="checkout-item">
                    <div class="item-image">
                        <img src="${item.image}" alt="${item.name}" onerror="this.src='assets/images/placeholder.jpg'">
                        <span class="item-quantity">${item.quantity}</span>
                    </div>
                    <div class="item-details">
                        <h4 class="item-name">${item.name}</h4>
                        <div class="item-variants">
                            <span class="variant">রং: ${item.color}</span>
                            <span class="variant">সাইজ: ${item.size}</span>
                        </div>
                    </div>
                    <div class="item-price">
                        ${item.price * item.quantity} ৳
                    </div>
                </div>
            `).join('');
        }

        function updateCheckoutSummary(items) {
            const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryCharge = calculateDeliveryCharge();
            const discount = 0; // Could be calculated from coupon
            const total = subtotal + deliveryCharge - discount;
            
            document.getElementById('checkout-subtotal').textContent = `${subtotal} ৳`;
            document.getElementById('checkout-delivery').textContent = `${deliveryCharge} ৳`;
            document.getElementById('checkout-discount').textContent = `-${discount} ৳`;
            document.getElementById('checkout-total').textContent = `${total} ৳`;
            document.getElementById('bkash-amount').textContent = total;
        }

        function calculateDeliveryCharge() {
            const areaSelect = document.getElementById('delivery-area');
            const selectedArea = areaSelect.value;
            
            switch(selectedArea) {
                case 'inside_dhaka':
                    return 80;
                case 'outside_dhaka':
                    return 150;
                case 'outside_divisional':
                    return 200;
                default:
                    return 0;
            }
        }

        function initializeEventListeners() {
            // Delivery area change
            document.getElementById('delivery-area').addEventListener('change', function() {
                const cartItems = getCartItems();
                updateCheckoutSummary(cartItems);
                updateDeliveryEstimate();
            });
            
            // Payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                    this.classList.add('active');
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                });
            });
            
            // Form submission
            document.getElementById('checkout-form').addEventListener('submit', handleFormSubmission);
        }

        function initializeFormValidation() {
            // Real-time validation for phone number
            document.getElementById('customer-phone').addEventListener('input', function(e) {
                const phone = e.target.value;
                const errorElement = document.getElementById('phone-error');
                
                if (!/^01[3-9]\d{8}$/.test(phone)) {
                    errorElement.textContent = 'সঠিক মোবাইল নম্বর লিখুন (01XXXXXXXXX)';
                } else {
                    errorElement.textContent = '';
                }
            });
            
            // Real-time validation for email
            document.getElementById('customer-email').addEventListener('input', function(e) {
                const email = e.target.value;
                const errorElement = document.getElementById('email-error');
                
                if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    errorElement.textContent = 'সঠিক ইমেইল ঠিকানা লিখুন';
                } else {
                    errorElement.textContent = '';
                }
            });
        }

        function updateDeliveryEstimate() {
            const areaSelect = document.getElementById('delivery-area');
            const selectedArea = areaSelect.value;
            const estimateElement = document.getElementById('delivery-estimate');
            
            switch(selectedArea) {
                case 'inside_dhaka':
                    estimateElement.innerHTML = `
                        <strong>১-২ কার্যদিবস</strong>
                        <p>ডেলিভারি চার্জ: ৮০ ৳</p>
                    `;
                    break;
                case 'outside_dhaka':
                    estimateElement.innerHTML = `
                        <strong>২-৪ কার্যদিবস</strong>
                        <p>ডেলিভারি চার্জ: ১৫০ ৳</p>
                    `;
                    break;
                case 'outside_divisional':
                    estimateElement.innerHTML = `
                        <strong>৩-৫ কার্যদিবস</strong>
                        <p>ডেলিভারি চার্জ: ২০০ ৳</p>
                    `;
                    break;
                default:
                    estimateElement.textContent = 'এলাকা নির্বাচন করুন';
            }
        }

        function handleFormSubmission(e) {
            e.preventDefault();
            
            if (validateForm()) {
                submitOrder();
            }
        }

        function validateForm() {
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
            
            // Validate name
            const name = document.getElementById('customer-name').value.trim();
            if (!name) {
                document.getElementById('name-error').textContent = 'নাম প্রয়োজন';
                isValid = false;
            }
            
            // Validate phone
            const phone = document.getElementById('customer-phone').value.trim();
            if (!/^01[3-9]\d{8}$/.test(phone)) {
                document.getElementById('phone-error').textContent = 'সঠিক মোবাইল নম্বর লিখুন';
                isValid = false;
            }
            
            // Validate email (optional)
            const email = document.getElementById('customer-email').value.trim();
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                document.getElementById('email-error').textContent = 'সঠিক ইমেইল ঠিকানা লিখুন';
                isValid = false;
            }
            
            // Validate delivery area
            const area = document.getElementById('delivery-area').value;
            if (!area) {
                document.getElementById('area-error').textContent = 'ডেলিভারি এলাকা নির্বাচন করুন';
                isValid = false;
            }
            
            // Validate address
            const address = document.getElementById('delivery-address').value.trim();
            if (!address) {
                document.getElementById('address-error').textContent = 'ঠিকানা প্রয়োজন';
                isValid = false;
            }
            
            // Validate district
            const district = document.getElementById('district').value.trim();
            if (!district) {
                document.getElementById('district-error').textContent = 'জেলা প্রয়োজন';
                isValid = false;
            }
            
            // Validate thana
            const thana = document.getElementById('thana').value.trim();
            if (!thana) {
                document.getElementById('thana-error').textContent = 'থানা প্রয়োজন';
                isValid = false;
            }
            
            // Validate terms agreement
            const termsAgreed = document.getElementById('terms-agree').checked;
            if (!termsAgreed) {
                document.getElementById('terms-error').textContent = 'আপনাকে সেবার শর্তাবলী স্বীকার করতে হবে';
                isValid = false;
            }
            
            return isValid;
        }

        function submitOrder() {
            const loadingOverlay = document.getElementById('loading-overlay');
            const placeOrderBtn = document.getElementById('place-order-btn');
            
            // Show loading
            loadingOverlay.style.display = 'flex';
            placeOrderBtn.disabled = true;
            placeOrderBtn.innerHTML = '<span class="btn-icon">⏳</span> প্রসেস হচ্ছে...';
            
            // Collect form data
            const formData = {
                customer_name: document.getElementById('customer-name').value.trim(),
                phone: document.getElementById('customer-phone').value.trim(),
                email: document.getElementById('customer-email').value.trim(),
                delivery_area: document.getElementById('delivery-area').value,
                address: document.getElementById('delivery-address').value.trim(),
                district: document.getElementById('district').value.trim(),
                thana: document.getElementById('thana').value.trim(),
                payment_method: document.querySelector('input[name="payment_method"]:checked').value,
                special_notes: document.getElementById('special-notes').value.trim(),
                products: getCartItems()
            };
            
            // Simulate API call
            setTimeout(() => {
                // In real implementation, this would call your Google Apps Script API
                console.log('Submitting order:', formData);
                
                // Simulate successful order
                const orderId = 'TS-' + Date.now();
                
                // Redirect to success page
                window.location.href = `success.html?order_id=${orderId}`;
                
            }, 2000);
        }

        // Initialize delivery estimate on page load
        setTimeout(updateDeliveryEstimate, 100);
    </script>
</body>
</html>